<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Disaster Response Coordination Platform</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .header p {
        color: #7f8c8d;
        margin-bottom: 15px;
      }

      .user-selector {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }

      .user-selector label {
        font-weight: 600;
        color: #2c3e50;
      }

      .user-selector select {
        padding: 8px 12px;
        border: 2px solid #3498db;
        border-radius: 5px;
        background: white;
        font-size: 14px;
      }

      .status {
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
      }

      .status.connected {
        background: #2ecc71;
        color: white;
      }

      .status.disconnected {
        background: #e74c3c;
        color: white;
      }

      .tabs {
        display: flex;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 10px 10px 0 0;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .tab {
        flex: 1;
        padding: 15px 20px;
        cursor: pointer;
        background: #ecf0f1;
        border: none;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .tab.active {
        background: #3498db;
        color: white;
      }

      .tab:hover:not(.active) {
        background: #bdc3c7;
      }

      .content {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 0 0 10px 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .section {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .section.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #bdc3c7;
        border-radius: 5px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #3498db;
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-right: 10px;
      }

      .btn:hover {
        background: #2980b9;
        transform: translateY(-2px);
      }

      .btn.danger {
        background: #e74c3c;
      }

      .btn.danger:hover {
        background: #c0392b;
      }

      .btn.success {
        background: #27ae60;
      }

      .btn.success:hover {
        background: #229954;
      }

      .results {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
      }

      .results h3 {
        margin-bottom: 15px;
        color: #2c3e50;
      }

      .results pre {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        font-size: 12px;
        line-height: 1.4;
      }

      .disaster-card,
      .resource-card,
      .social-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .disaster-card h4,
      .resource-card h4,
      .social-card h4 {
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .tags {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
        margin-top: 10px;
      }

      .tag {
        background: #3498db;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }

      .priority-critical {
        background: #e74c3c;
      }
      .priority-high {
        background: #f39c12;
      }
      .priority-normal {
        background: #27ae60;
      }
      .priority-low {
        background: #95a5a6;
      }

      .real-time-updates {
        background: #e8f5e8;
        border: 1px solid #27ae60;
        border-radius: 5px;
        padding: 10px;
        margin-top: 15px;
      }

      .real-time-updates h4 {
        color: #27ae60;
        margin-bottom: 10px;
      }

      .update-item {
        background: white;
        padding: 8px 12px;
        border-radius: 4px;
        margin-bottom: 8px;
        border-left: 4px solid #27ae60;
        font-size: 14px;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        border-radius: 5px;
        padding: 10px;
        margin-top: 10px;
      }

      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        border-radius: 5px;
        padding: 10px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üö® Disaster Response Coordination Platform</h1>
        <p>
          Real-time disaster management and coordination system with geospatial
          intelligence
        </p>
        <div class="user-selector">
          <label for="currentUser">Acting as:</label>
          <select id="currentUser" onchange="updateCurrentUser()">
            <option value="citizen1">citizen1 (Contributor)</option>
            <option value="netrunnerX">netrunnerX (Admin)</option>
            <option value="reliefAdmin">reliefAdmin (Admin)</option>
            <option value="volunteer1">volunteer1 (Contributor)</option>
          </select>
          <span id="connectionStatus" class="status disconnected"
            >Disconnected</span
          >
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="showSection('disasters')">
          üèòÔ∏è Disasters
        </button>
        <button class="tab" onclick="showSection('geocoding')">
          üó∫Ô∏è Geocoding
        </button>
        <button class="tab" onclick="showSection('social')">
          üì± Social Media
        </button>
        <button class="tab" onclick="showSection('resources')">
          üè• Resources
        </button>
        <button class="tab" onclick="showSection('updates')">
          üì¢ Official Updates
        </button>
        <button class="tab" onclick="showSection('verification')">
          üîç Verification
        </button>
      </div>

      <div class="content">
        <!-- Disasters Section -->
        <div id="disasters" class="section active">
          <h2>Disaster Management</h2>

          <div class="form-group">
            <h3>Create New Disaster</h3>
            <form id="disasterForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="disasterTitle">Title:</label>
                  <input
                    type="text"
                    id="disasterTitle"
                    placeholder="e.g., NYC Flood Emergency"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="disasterLocation">Location Name:</label>
                  <input
                    type="text"
                    id="disasterLocation"
                    placeholder="e.g., Manhattan, NYC"
                    required
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="disasterDescription">Description:</label>
                <textarea
                  id="disasterDescription"
                  placeholder="Describe the disaster situation..."
                  required
                ></textarea>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="disasterTags">Tags (comma-separated):</label>
                  <input
                    type="text"
                    id="disasterTags"
                    placeholder="flood, urgent, manhattan"
                  />
                </div>
                <div class="form-group">
                  <label for="disasterCoords">Coordinates (optional):</label>
                  <input
                    type="text"
                    id="disasterCoords"
                    placeholder="40.7128, -74.0060"
                  />
                </div>
              </div>

              <button type="submit" class="btn">Create Disaster</button>
              <button type="button" class="btn" onclick="loadDisasters()">
                Refresh List
              </button>
            </form>
          </div>

          <div class="results" id="disasterResults">
            <h3>Active Disasters</h3>
            <p>Click "Refresh List" to load disasters...</p>
          </div>
        </div>

        <!-- Geocoding Section -->
        <div id="geocoding" class="section">
          <h2>Location Extraction & Geocoding</h2>

          <div class="form-group">
            <h3>Extract Location from Text</h3>
            <form id="geocodingForm">
              <div class="form-group">
                <label for="extractText">Text to analyze:</label>
                <textarea
                  id="extractText"
                  placeholder="Heavy flooding in Manhattan near Central Park. Water levels rising rapidly..."
                  required
                ></textarea>
              </div>

              <button type="submit" class="btn">Extract & Geocode</button>
            </form>
          </div>

          <div class="form-group">
            <h3>Direct Geocoding</h3>
            <form id="directGeocodingForm">
              <div class="form-group">
                <label for="locationName">Location Name:</label>
                <input
                  type="text"
                  id="locationName"
                  placeholder="Manhattan, NYC"
                  required
                />
              </div>

              <button type="submit" class="btn">Geocode Location</button>
            </form>
          </div>

          <div class="results" id="geocodingResults"></div>
        </div>

        <!-- Social Media Section -->
        <div id="social" class="section">
          <h2>Social Media Monitoring</h2>

          <div class="form-group">
            <h3>Monitor Social Media Reports</h3>
            <form id="socialForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="socialDisasterId">Disaster ID:</label>
                  <input
                    type="text"
                    id="socialDisasterId"
                    placeholder="1"
                    value="1"
                  />
                </div>
                <div class="form-group">
                  <label for="socialKeywords"
                    >Keywords (comma-separated):</label
                  >
                  <input
                    type="text"
                    id="socialKeywords"
                    placeholder="flood, emergency, help"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="socialPriority">Priority Filter:</label>
                  <select id="socialPriority">
                    <option value="">All Priorities</option>
                    <option value="critical">Critical</option>
                    <option value="high">High</option>
                    <option value="normal">Normal</option>
                    <option value="low">Low</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="socialLimit">Limit:</label>
                  <input
                    type="number"
                    id="socialLimit"
                    value="10"
                    min="1"
                    max="50"
                  />
                </div>
              </div>

              <button type="submit" class="btn">Monitor Social Media</button>
              <button type="button" class="btn" onclick="getMockSocialMedia()">
                Mock Data
              </button>
            </form>
          </div>

          <div class="results" id="socialResults"></div>
        </div>

        <!-- Resources Section -->
        <div id="resources" class="section">
          <h2>Resource Management</h2>

          <div class="form-group">
            <h3>Find Nearby Resources</h3>
            <form id="resourcesForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="resourceDisasterId">Disaster ID:</label>
                  <input
                    type="text"
                    id="resourceDisasterId"
                    placeholder="1"
                    value="1"
                  />
                </div>
                <div class="form-group">
                  <label for="resourceCoords">Coordinates (lat, lng):</label>
                  <input
                    type="text"
                    id="resourceCoords"
                    placeholder="40.7831, -73.9712"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="resourceRadius">Radius (km):</label>
                  <input
                    type="number"
                    id="resourceRadius"
                    value="10"
                    min="1"
                    max="100"
                  />
                </div>
                <div class="form-group">
                  <label for="resourceType">Type Filter:</label>
                  <select id="resourceType">
                    <option value="">All Types</option>
                    <option value="shelter">Shelter</option>
                    <option value="medical">Medical</option>
                    <option value="food">Food</option>
                    <option value="supplies">Supplies</option>
                    <option value="evacuation">Evacuation</option>
                  </select>
                </div>
              </div>

              <button type="submit" class="btn">Find Resources</button>
            </form>
          </div>

          <div class="form-group">
            <h3>Add New Resource</h3>
            <form id="addResourceForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="newResourceName">Name:</label>
                  <input
                    type="text"
                    id="newResourceName"
                    placeholder="Emergency Shelter"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="newResourceLocation">Location Name:</label>
                  <input
                    type="text"
                    id="newResourceLocation"
                    placeholder="Community Center, NYC"
                    required
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="newResourceType">Type:</label>
                  <select id="newResourceType" required>
                    <option value="shelter">Shelter</option>
                    <option value="medical">Medical</option>
                    <option value="food">Food</option>
                    <option value="supplies">Supplies</option>
                    <option value="evacuation">Evacuation</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="newResourceCapacity">Capacity:</label>
                  <input
                    type="number"
                    id="newResourceCapacity"
                    placeholder="100"
                    min="0"
                  />
                </div>
              </div>

              <button type="submit" class="btn success">Add Resource</button>
            </form>
          </div>

          <div class="results" id="resourcesResults"></div>
        </div>

        <!-- Official Updates Section -->
        <div id="updates" class="section">
          <h2>Official Updates</h2>

          <div class="form-group">
            <h3>Fetch Official Updates</h3>
            <form id="updatesForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="updatesDisasterId">Disaster ID:</label>
                  <input
                    type="text"
                    id="updatesDisasterId"
                    placeholder="1"
                    value="1"
                  />
                </div>
                <div class="form-group">
                  <label for="updatesSource">Source Filter:</label>
                  <select id="updatesSource">
                    <option value="">All Sources</option>
                    <option value="fema">FEMA</option>
                    <option value="redcross">Red Cross</option>
                    <option value="nws">National Weather Service</option>
                    <option value="nyc">NYC Emergency Management</option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="updatesPriority">Priority Filter:</label>
                  <select id="updatesPriority">
                    <option value="">All Priorities</option>
                    <option value="critical">Critical</option>
                    <option value="high">High</option>
                    <option value="normal">Normal</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="updatesLimit">Limit:</label>
                  <input
                    type="number"
                    id="updatesLimit"
                    value="10"
                    min="1"
                    max="50"
                  />
                </div>
              </div>

              <button type="submit" class="btn">Fetch Updates</button>
            </form>
          </div>

          <div class="results" id="updatesResults"></div>
        </div>

        <!-- Verification Section -->
        <div id="verification" class="section">
          <h2>Image Verification</h2>

          <div class="form-group">
            <h3>Verify Image Authenticity</h3>
            <form id="verificationForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="verifyDisasterId">Disaster ID:</label>
                  <input
                    type="text"
                    id="verifyDisasterId"
                    placeholder="1"
                    value="1"
                  />
                </div>
                <div class="form-group">
                  <label for="verifyImageUrl">Image URL:</label>
                  <input
                    type="url"
                    id="verifyImageUrl"
                    placeholder="http://example.com/flood.jpg"
                    required
                  />
                </div>
              </div>

              <button type="submit" class="btn">Verify Image</button>
            </form>
          </div>

          <div class="results" id="verificationResults"></div>
        </div>
      </div>

      <div class="real-time-updates">
        <h4>üî¥ Real-time Updates</h4>
        <div id="realTimeUpdates">
          <p>Connecting to real-time updates...</p>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const API_BASE = "http://localhost:5000/api";
      let currentUser = "citizen1";
      let socket;

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        connectWebSocket();
        setupFormHandlers();
      });

      // WebSocket connection
      function connectWebSocket() {
        socket = io("http://localhost:5000");

        socket.on("connect", function () {
          document.getElementById("connectionStatus").textContent = "Connected";
          document.getElementById("connectionStatus").className =
            "status connected";
          addRealTimeUpdate("Connected to real-time updates");
        });

        socket.on("disconnect", function () {
          document.getElementById("connectionStatus").textContent =
            "Disconnected";
          document.getElementById("connectionStatus").className =
            "status disconnected";
          addRealTimeUpdate("Disconnected from real-time updates");
        });

        socket.on("disaster_updated", function (data) {
          addRealTimeUpdate(
            `Disaster ${data.action}: ${data.data.title || data.data.id}`
          );
        });

        socket.on("social_media_updated", function (data) {
          addRealTimeUpdate(
            `Social media: ${data.new_posts.length} new posts for disaster ${data.disaster_id}`
          );
        });

        socket.on("resources_updated", function (data) {
          addRealTimeUpdate(
            `Resources updated for disaster ${data.disaster_id}`
          );
        });
      }

      function addRealTimeUpdate(message) {
        const updatesContainer = document.getElementById("realTimeUpdates");
        const updateItem = document.createElement("div");
        updateItem.className = "update-item";
        updateItem.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
        updatesContainer.insertBefore(updateItem, updatesContainer.firstChild);

        // Keep only last 5 updates
        while (updatesContainer.children.length > 5) {
          updatesContainer.removeChild(updatesContainer.lastChild);
        }
      }

      function updateCurrentUser() {
        currentUser = document.getElementById("currentUser").value;
        addRealTimeUpdate(`Switched to user: ${currentUser}`);
      }

      function showSection(sectionName) {
        // Hide all sections
        document.querySelectorAll(".section").forEach((section) => {
          section.classList.remove("active");
        });

        // Remove active class from all tabs
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Show selected section
        document.getElementById(sectionName).classList.add("active");

        // Add active class to clicked tab
        event.target.classList.add("active");
      }

      function setupFormHandlers() {
        // Disaster form
        document
          .getElementById("disasterForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const title = document.getElementById("disasterTitle").value;
            const location_name =
              document.getElementById("disasterLocation").value;
            const description = document.getElementById(
              "disasterDescription"
            ).value;
            const tags = document
              .getElementById("disasterTags")
              .value.split(",")
              .map((t) => t.trim())
              .filter((t) => t);
            const coords = document.getElementById("disasterCoords").value;

            let location = null;
            if (coords) {
              const [lat, lng] = coords
                .split(",")
                .map((c) => parseFloat(c.trim()));
              if (!isNaN(lat) && !isNaN(lng)) {
                location = { lat, lng };
              }
            }

            try {
              const response = await fetch(`${API_BASE}/disasters`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "X-User-Id": currentUser,
                },
                body: JSON.stringify({
                  title,
                  location_name,
                  description,
                  tags,
                  location,
                }),
              });

              const result = await response.json();

              if (response.ok) {
                showSuccess("Disaster created successfully!");
                document.getElementById("disasterForm").reset();
                loadDisasters();
              } else {
                showError(result.error || "Failed to create disaster");
              }
            } catch (error) {
              showError("Network error: " + error.message);
            }
          });

        // Geocoding form
        document
          .getElementById("geocodingForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const text = document.getElementById("extractText").value;

            try {
              const response = await fetch(`${API_BASE}/geocode`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "X-User-Id": currentUser,
                },
                body: JSON.stringify({ text }),
              });

              const result = await response.json();
              displayResults("geocodingResults", result);
            } catch (error) {
              showError("Network error: " + error.message);
            }
          });

        // Direct geocoding form
        document
          .getElementById("directGeocodingForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const location_name = document.getElementById("locationName").value;

            try {
              const response = await fetch(`${API_BASE}/geocode`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "X-User-Id": currentUser,
                },
                body: JSON.stringify({ location_name }),
              });

              const result = await response.json();
              displayResults("geocodingResults", result);
            } catch (error) {
              showError("Network error: " + error.message);
            }
          });

        // Social media form
        document
          .getElementById("socialForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const disasterId =
              document.getElementById("socialDisasterId").value;
            const keywords = document.getElementById("socialKeywords").value;
            const priority = document.getElementById("socialPriority").value;
            const limit = document.getElementById("socialLimit").value;

            const params = new URLSearchParams();
            if (keywords) params.append("keywords", keywords);
            if (priority) params.append("priority", priority);
            if (limit) params.append("limit", limit);

            try {
              const response = await fetch(
                `${API_BASE}/disasters/${disasterId}/social-media?${params}`,
                {
                  headers: { "X-User-Id": currentUser },
                }
              );

              const result = await response.json();
              displaySocialMediaResults(result);
            } catch (error) {
              showError("Network error: " + error.message);
            }
          });

        // Resources form
        document
          .getElementById("resourcesForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const disasterId =
              document.getElementById("resourceDisasterId").value;
            const coords = document.getElementById("resourceCoords").value;
            const radius = document.getElementById("resourceRadius").value;
            const type = document.getElementById("resourceType").value;

            const params = new URLSearchParams();
            if (coords) {
              const [lat, lng] = coords.split(",").map((c) => c.trim());
              params.append("lat", lat);
              params.append("lng", lng);
            }
            if (radius) params.append("radius", radius);
            if (type) params.append("type", type);

            try {
              const response = await fetch(
                `${API_BASE}/disasters/${disasterId}/resources?${params}`,
                {
                  headers: { "X-User-Id": currentUser },
                }
              );

              const result = await response.json();
              displayResourceResults(result);
            } catch (error) {
              showError("Network error: " + error.message);
            }
          });

        // Add resource form
        document
          .getElementById("addResourceForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const disasterId =
              document.getElementById("resourceDisasterId").value;
            const name = document.getElementById("newResourceName").value;
            const location_name = document.getElementById(
              "newResourceLocation"
            ).value;
            const type = document.getElementById("newResourceType").value;
            const capacity = document.getElementById(
              "newResourceCapacity"
            ).value;

            try {
              const response = await fetch(
                `${API_BASE}/disasters/${disasterId}/resources`,
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    "X-User-Id": currentUser,
                  },
                  body: JSON.stringify({
                    name,
                    location_name,
                    type,
                    capacity: parseInt(capacity) || 0,
                  }),
                }
              );

              const result = await response.json();

              if (response.ok) {
                showSuccess("Resource added successfully!");
                document.getElementById("addResourceForm").reset();
              } else {
                showError(result.error || "Failed to add resource");
              }
            } catch (error) {
              showError("Network error: " + error.message);
            }
          });

        // Updates form
        document
          .getElementById("updatesForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const disasterId =
              document.getElementById("updatesDisasterId").value;
            const source = document.getElementById("updatesSource").value;
            const priority = document.getElementById("updatesPriority").value;
            const limit = document.getElementById("updatesLimit").value;

            const params = new URLSearchParams();
            if (source) params.append("source", source);
            if (priority) params.append("priority", priority);
            if (limit) params.append("limit", limit);

            try {
              const response = await fetch(
                `${API_BASE}/disasters/${disasterId}/official-updates?${params}`,
                {
                  headers: { "X-User-Id": currentUser },
                }
              );

              const result = await response.json();
              displayOfficialUpdates(result);
            } catch (error) {
              showError("Network error: " + error.message);
            }
          });

        // Verification form
        document
          .getElementById("verificationForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const disasterId =
              document.getElementById("verifyDisasterId").value;
            const image_url = document.getElementById("verifyImageUrl").value;

            try {
              const response = await fetch(
                `${API_BASE}/disasters/${disasterId}/verify-image`,
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    "X-User-Id": currentUser,
                  },
                  body: JSON.stringify({ image_url }),
                }
              );

              const result = await response.json();
              displayVerificationResults(result);
            } catch (error) {
              showError("Network error: " + error.message);
            }
          });
      }

      async function loadDisasters() {
        try {
          const response = await fetch(`${API_BASE}/disasters`, {
            headers: { "X-User-Id": currentUser },
          });

          const result = await response.json();
          displayDisasterResults(result);
        } catch (error) {
          showError("Network error: " + error.message);
        }
      }

      async function getMockSocialMedia() {
        try {
          const response = await fetch(
            `${API_BASE}/../mock-social-media?keywords=flood,emergency`
          );
          const result = await response.json();
          displaySocialMediaResults(result);
        } catch (error) {
          showError("Network error: " + error.message);
        }
      }

      function displayResults(containerId, data) {
        const container = document.getElementById(containerId);
        container.innerHTML = `<h3>Results</h3><pre>${JSON.stringify(
          data,
          null,
          2
        )}</pre>`;
      }

      function displayDisasterResults(data) {
        const container = document.getElementById("disasterResults");
        let html = "<h3>Active Disasters</h3>";

        if (data.data && data.data.length > 0) {
          data.data.forEach((disaster) => {
            html += `
                        <div class="disaster-card">
                            <h4>${disaster.title}</h4>
                            <p><strong>Location:</strong> ${
                              disaster.location_name
                            }</p>
                            <p><strong>Description:</strong> ${
                              disaster.description
                            }</p>
                            <p><strong>Owner:</strong> ${disaster.owner_id}</p>
                            <p><strong>Created:</strong> ${new Date(
                              disaster.created_at
                            ).toLocaleString()}</p>
                            <div class="tags">
                                ${
                                  disaster.tags
                                    ? disaster.tags
                                        .map(
                                          (tag) =>
                                            `<span class="tag">${tag}</span>`
                                        )
                                        .join("")
                                    : ""
                                }
                            </div>
                        </div>
                    `;
          });
        } else {
          html += "<p>No disasters found.</p>";
        }

        container.innerHTML = html;
      }

      function displaySocialMediaResults(data) {
        const container = document.getElementById("socialResults");
        let html = "<h3>Social Media Reports</h3>";

        if (data.data && data.data.length > 0) {
          data.data.forEach((post) => {
            html += `
                        <div class="social-card">
                            <h4>@${post.username || post.user}</h4>
                            <p>${post.content || post.post}</p>
                            <p><strong>Priority:</strong> <span class="tag priority-${
                              post.priority
                            }">${post.priority}</span></p>
                            <p><strong>Location:</strong> ${
                              post.location ||
                              post.extracted_location ||
                              "Unknown"
                            }</p>
                            <p><strong>Time:</strong> ${new Date(
                              post.timestamp
                            ).toLocaleString()}</p>
                            <div class="tags">
                                ${
                                  post.hashtags
                                    ? post.hashtags
                                        .map(
                                          (tag) =>
                                            `<span class="tag">#${tag}</span>`
                                        )
                                        .join("")
                                    : ""
                                }
                            </div>
                        </div>
                    `;
          });
        } else {
          html += "<p>No social media reports found.</p>";
        }

        container.innerHTML = html;
      }

      function displayResourceResults(data) {
        const container = document.getElementById("resourcesResults");
        let html = "<h3>Available Resources</h3>";

        if (data.data && data.data.length > 0) {
          data.data.forEach((resource) => {
            html += `
                        <div class="resource-card">
                            <h4>${resource.name}</h4>
                            <p><strong>Type:</strong> ${resource.type}</p>
                            <p><strong>Location:</strong> ${
                              resource.location_name
                            }</p>
                            <p><strong>Capacity:</strong> ${
                              resource.current_occupancy || 0
                            }/${resource.capacity || "Unlimited"}</p>
                            <p><strong>Contact:</strong> ${
                              resource.contact || "N/A"
                            }</p>
                            ${
                              resource.distance_km
                                ? `<p><strong>Distance:</strong> ${resource.distance_km} km</p>`
                                : ""
                            }
                            <div class="tags">
                                ${
                                  resource.amenities
                                    ? resource.amenities
                                        .map(
                                          (amenity) =>
                                            `<span class="tag">${amenity}</span>`
                                        )
                                        .join("")
                                    : ""
                                }
                            </div>
                        </div>
                    `;
          });
        } else {
          html += "<p>No resources found.</p>";
        }

        container.innerHTML = html;
      }

      function displayOfficialUpdates(data) {
        const container = document.getElementById("updatesResults");
        let html = "<h3>Official Updates</h3>";

        if (data.data && data.data.length > 0) {
          data.data.forEach((update) => {
            html += `
                        <div class="disaster-card">
                            <h4>${update.title}</h4>
                            <p><strong>Source:</strong> ${update.source}</p>
                            <p><strong>Priority:</strong> <span class="tag priority-${
                              update.priority
                            }">${update.priority}</span></p>
                            <p>${update.content}</p>
                            <p><strong>Published:</strong> ${new Date(
                              update.published_at
                            ).toLocaleString()}</p>
                            ${
                              update.url
                                ? `<p><a href="${update.url}" target="_blank">Read more</a></p>`
                                : ""
                            }
                        </div>
                    `;
          });
        } else {
          html += "<p>No official updates found.</p>";
        }

        container.innerHTML = html;
      }

      function displayVerificationResults(data) {
        const container = document.getElementById("verificationResults");
        const verification = data.verification;

        let html = `
                <h3>Image Verification Results</h3>
                <div class="disaster-card">
                    <h4>Verification Status: <span class="tag priority-${
                      verification.status === "authentic"
                        ? "normal"
                        : verification.status === "suspicious"
                        ? "high"
                        : "critical"
                    }">${verification.status.toUpperCase()}</span></h4>
                    <p><strong>Authenticity Score:</strong> ${(
                      verification.authenticity_score * 100
                    ).toFixed(1)}%</p>
                    <p><strong>Confidence:</strong> ${
                      verification.confidence
                    }</p>
                    <p><strong>Analysis:</strong> ${verification.analysis}</p>
                    <p><strong>Detected Objects:</strong> ${verification.detected_objects.join(
                      ", "
                    )}</p>
                    <p><strong>Context Match:</strong> ${
                      verification.context_match ? "Yes" : "No"
                    }</p>
                    ${
                      verification.flags && verification.flags.length > 0
                        ? `
                        <p><strong>Flags:</strong></p>
                        <div class="tags">
                            ${verification.flags
                              .map(
                                (flag) =>
                                  `<span class="tag priority-high">${flag}</span>`
                              )
                              .join("")}
                        </div>
                    `
                        : ""
                    }
                    <p><strong>Verified At:</strong> ${new Date(
                      verification.verified_at
                    ).toLocaleString()}</p>
                </div>
            `;

        container.innerHTML = html;
      }

      function showError(message) {
        const errorDiv = document.createElement("div");
        errorDiv.className = "error";
        errorDiv.textContent = message;
        document.body.appendChild(errorDiv);

        setTimeout(() => {
          document.body.removeChild(errorDiv);
        }, 5000);
      }

      function showSuccess(message) {
        const successDiv = document.createElement("div");
        successDiv.className = "success";
        successDiv.textContent = message;
        document.body.appendChild(successDiv);

        setTimeout(() => {
          document.body.removeChild(successDiv);
        }, 3000);
      }
    </script>
  </body>
</html>
